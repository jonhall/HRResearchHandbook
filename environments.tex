%%%For Activities and the like
%%TODO clean up Activity code
\newcommand{\exampleColor}{CornflowerBlue!40!white}
\newcommand{\activityColor}{Pink!70!white} 
\newcommand{\discussionColor}{\activityColor} 
\newcommand{\tipColor}{Green!20!white} 
\newcommand{\quoteColor}{Linen} 
\newcommand{\frameColor}{black!50!white}
\usepackage[many]{tcolorbox}
\newtcolorbox{activity}{
%  enhanced,
  breakable,
%  pad at break=2mm,
  left=2mm,
  right=2mm,
  colback=\activityColor,
  colframe=\frameColor,
%  drop fuzzy midday shadow=black!50!yellow, 
  width={\textwidth}, 
  frame hidden, 
  segmentation hidden,
  before=\par\vspace*{2mm},
  after=\par\bigskip,
	title=%\textbf
		{\GetQuestionProperty{subtitle}{\CurrentQuestionID}\hfill\#\CurrentQuestionID}}

\newtcolorbox{discussion}{
%  enhanced,
  breakable,
  pad at break=2mm,
  left=2mm,
  right=2mm,
  colback=\discussionColor,
  colframe=\frameColor,
%  drop fuzzy midday shadow=black!50!yellow, 
  width={\textwidth}, 
  frame hidden, 
  segmentation hidden,
  before=\par\vspace*{2mm},
  after=\par\bigskip,
  title={Discussion\hfill \#\CurrentQuestionID},
}

 %%Guidance environment
\newenvironment{guidance}{\tcbsubtitle%[before skip=\baselineskip]%
          {\textbf{Guidance}}}
    {}

\newtcolorbox{tip}{
%  enhanced,
  breakable,
  pad at break=2mm,
  left=2mm,
  right=2mm,
  colback=\tipColor,
  colframe=\frameColor,
%  drop fuzzy midday shadow=black!50!yellow, 
  width={\textwidth}, 
  frame hidden, 
  segmentation hidden,
  before=\par\vspace*{2mm},
  after=\par\bigskip,
  title={Tip},
}

\newtcolorbox{example}[1]{
%  enhanced,
  breakable,
  pad at break=2mm,
  left=2mm,
  right=2mm,
  colback=\exampleColor,
  colframe=\frameColor,
%  drop fuzzy midday shadow=black!50!yellow, 
  width={\textwidth}, 
%  frame hidden, 
  segmentation hidden,
  before=\par\vspace*{2mm},
  after=\par\bigskip,
  title=\textbf{#1}}%
  
\newtcolorbox{running}[1]{
%  enhanced,
  breakable,
  pad at break=2mm,
  left=2mm,
  right=2mm,
  colback=\exampleColor,
  colframe=\frameColor,
%  drop fuzzy midday shadow=black!50!yellow, 
  width={\textwidth}, 
%  frame hidden, 
  segmentation hidden,
  before=\par\vspace*{2mm},
  after=\par\bigskip,
  title=\textbf{#1}}%

%%Quote environment
\renewtcolorbox{quote}{
%  enhanced,
  breakable,
  pad at break=2mm,
  left=2mm,
  right=2mm,
  colback=\quoteColor,
  colframe=\frameColor,
%  drop fuzzy midday shadow=black!50!yellow, 
  width={\textwidth}, 
%  frame hidden, 
  segmentation hidden,
  before=\par\vspace*{2mm},
  after=\par\bigskip,
  title=\textbf{Quote}}%

%%%For question solution pairs, with delayed printing
\usepackage{exsheets}
\SetupExSheets{
	headings=empty,
	question/pre-hook=\begin{activity},
	question/post-hook=\end{activity},
	solution/pre-hook=\IfInsideQuestionTF{\tcbsubtitle{Discussion}}{\begin{discussion}},
	solution/post-hook=\IfInsideQuestionTF{}{\end{discussion}},
	solution/print=true,
	}
%\ifoptionfinal{\SetupExSheets{solution/print=false}}{}	

%%Answer environment
%%Is this used?
\newenvironment{answer}{\textbf{Answer}\begin{trivlist}
\item}
    {\end{trivlist}}
    
    
%%%%%%% for choosing strategies/methods and related further deep dive into literature
%%%%From Stage 4
%%Resource type = fulltext cite in itemized list
%%From authoryear.cbx
%% Candidate for moving to header files
\DeclareMultiCiteCommand{\fullcites}{\fullcite}{\multicitedelim\\}

\DeclareCiteCommand{\resourcelistcite}
  {\usebibmacro{prenote}\begin{itemize}\item[] }
  {\usedriver
     {\DeclareNameAlias{sortname}{default}}
     {\thefield{entrytyper}}
  } 
%     {%
%		\footnote{\thefield{annotation}}
%	 }
  {\item[] \addspace}
  {\end{itemize}\usebibmacro{postnote}}

\newenvironment{MoreDetails}[0]{\subsection{More details} The following citations provide good starting points for further reading: \label{ssect:MoreDetails}}{}


\newcommand{\ResGenTechnique}[1]{\begin{question}[subtitle={Activity: Do I need to know about #1?}]
Check back to your chosen research strategy from Stage 3. Does it involve data generation using #1? If so, read through the remainder of this section and complete the activities.
\end{question}}

\newcommand{\ResGenExtras}[2]{\begin{question}[subtitle={Activity: Deep dive into #1}]
To find out more about #1, take a look at these resources:

\fullcites#2

\end{question}}

\newcommand{\ResModTechnique}[1]{\begin{question}[subtitle={Activity: Do I need to know about #1?}]
Check back to your chosen research strategy from Stage 3. Does it involve modelling using #1? If so, read through the remainder of this section and complete the activities.
\end{question}}

\newcommand{\ResModExtras}[2]{\begin{question}[subtitle={Activity: Deep dive into #1}]
To find out more about #1, take a look at these resources:

\fullcites#2

\end{question}}

\newcommand{\ReadingExtras}[2]{\begin{question}[subtitle={Activity: Deep dive into #1}]
To find out more about #1, take a look at these resources:

\fullcites#2

\end{question}}

%%%%%%%%%