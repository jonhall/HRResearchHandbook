%%Move to embedded table.tex

%%Tables and figures labelled consecutively – TODO: not working
\RequirePackage{chngcntr}
\counterwithout*{table}{part}
\counterwithout*{figure}{part}

%%Migrating to tabularray as for tabular
\RequirePackage{tabularray}
\UseTblrLibrary{varwidth}%%For itemize in entries
\UseTblrLibrary{booktabs}%%For lines in entries
\UseTblrLibrary{siunitx}%%For aligned decimal points
%\SetTblrOuter{expand=\frameColor}
%\SetTblrOuter{expand=\activityColor}

%%Define the widest tables width
%\newlength{\widetablewidth}
%\newlength{\narrowtablewidth}
%\newcommand{\widetablewidth}{\the\dimexpr(\textwidth+\marginparsep+\marginparwidth)\relax}
%\newcommand{\narrowtablewidth}{\the\dimexpr(\textwidth-\marginparwidth/8)\relax}
\newcommand{\widetablewidth}{\textwidth+\marginparsep+\marginparwidth}
\newcommand{\narrowtablewidth}{\textwidth-\marginparwidth/4}%Ensure - isn't –

%Table colours – not used
\newcommand{\tableBackgroundColor}{black!90!white}

%%Create new column type for ragged right in body.
\NewColumnType{R}[1][1]{X[#1,preto={\raggedright}]}

%%Simple N column table
\NewDocumentEnvironment{SimpleNColTable}{
		m% 					% label
		m%					% number of columns
		O{\widetablewidth} 	% tablewidth (default: \widetablewidth)
		m% 					% caption
		O{XXXXXXXXXX|}%	% optional colspec
		O{}					% Any other options to pass
		+b%					% body – *{10} is "upto 10 repeats, depending on how many entries the table has.
		}%
		{
		\begin{tblr}[
				long,
	 			label={#1},
				caption={#4}
%				expand=\activityColor
			]{
		  		colspec = {#5},
	 			width = {#3},
				stretch=-1,%%Allows lists in body, with no padding
				hlines = {fg = \frameColor, wd=2pt}, %column{2} = {co=1}, 
				vline{Z} = {fg = \frameColor, wd=2pt}, %column{2} = {co=1}, 
				colsep = 5pt,
%TODO change colours to neutral/transparent, if possible.
				column{1} = {fg = white, bg=\frameColor},%, font=\sffamily},
				row{1} = {font=\bfseries, fg = white, bg=\frameColor},%, font=\bfseries\sffamily},
				rows = {m,rowsep = 3mm},
				rowhead = 1,
				#6, % Any other options passed directly
				measure=vbox, 
			}
			#7
		\end{tblr}
	}{}

%%Complex table definitions
%%All ResActTables follow this format
\NewTableCommand{\ResActTableHeader}{&Deliverable&{Writing Outcome:\\ by the end of this stage you will}&Effort&Supervisor Interaction}
\NewTableCommand{\ResActChHeader}{\SetCell[c=5]{l}}
\NewTableCommand{\ReportLineHeader}{\SetCell[c=3]{l}}

\NewDocumentEnvironment{ResActTable}{O{Missing caption}+b}{
	\begin{tblr}[
			long,
			caption={#1}
		]{
			measure=vbox, 
			stretch=-1,%%Allows lists in body, with no padding
 			width=\widetablewidth,
	  		hlines = {fg = \frameColor, wd=2pt}, %column{2} = {co=1}, 
			vline{Z} = {fg = \frameColor, wd=2pt}, %column{2} = {co=1}, 
			colsep = 5pt,
			column{1} = {fg = white, bg=\frameColor},%, font=\sffamily},
			row{1} = {fg = white, bg=\frameColor},%, font=\bfseries\sffamily},
			rowhead = 1,
			colspec = {lX[8]X[13]X[-1]X[5]|}}
%Header					
	&Deliverable&{Writing Outcome:\\ by the end of this stage you will}&Effort&Supervisor Interaction\\
%Body
		#2
	\end{tblr}}{}
	
%%All ReportTables follow this format
\NewTableCommand{\ReportTableHeader}{&Deliverable&{Writing Outcome:\\ by the end of this stage you will}&Effort&Supervisor Interaction}
\NewTableCommand{\ReportChHeader}{\SetCell[c=5]{l}}

\NewDocumentEnvironment{ReportTable}{
		m					%label
		O{Missing caption}	%caption
		+b					%body
		}{
	\begin{tblr}[long,caption={#2},label={#1}]{measure=vbox, stretch=-1,%%Allows lists in body, with no padding
 				 	width=\widetablewidth,
			  		hlines = {fg = \frameColor, wd=2pt}, %column{2} = {co=1}, 
					vline{Z} = {fg = \frameColor, wd=2pt}, %column{2} = {co=1}, 
					colsep = 5pt,
					column{1} = {fg = white, bg=\frameColor},%, font=\sffamily},
					row{1} = {fg = white, bg=\frameColor},%, font=\bfseries\sffamily},
					rowhead = 1,
%					cell{1}{1}={c=1}{l, font=\bfseries},
%					cell{1}{2}={c=1}{l, font=\bfseries},
					colspec={X[8,l]X[18]X[4,preto={\raggedright}]},
					}
%Header					
	Part/Structure&Guidance\\
%Body
		#3
	\end{tblr}}{}
	
%%ReportTable auxiliaries
\newcommand{\basedOn}[1]{that is based on the work you completed in~\Cref{#1}}
%%repeated report table messages
\newcommand\tablenocontent{No content at this stage}
\newcommand\tablecites{You should include those references that you cite in new and/or update chapters}
%\newcommand\tableconsiderprogress{Ensure all cited references are listed in this section}
\newcommand\tablefinalise[1]{After completing your work for this state, finalise your #1}
\newcommand\tableminor[1]{Reread and make any minor modifications to your #1}
\newcommand\tablecheck[1]{You should check your #1 for correctness and completeness}
	
	
%%ReportTable list formats 
\usepackage{enumitem}
\newlist{reportenum}{enumerate}{2}
\setlist[reportenum]{nosep}
\setlist[reportenum,1]{label={\arabic*}}
%\setlist[reportenum,2]{resume}
\newlist{reportitem}{itemize}{1}
\setlist[reportitem]{nosep,label=\textbullet}

\usepackage{ifthen}

\newcommand{\ordColour}[0]{gray8}

\newcommand{\ritem}[2]{%
	\ifthenelse{\equal{#1}{!}}
		%%new section
		{\item[\color{red}{\footnotesize new}]\color{white}}
		{\ifthenelse{\equal{#1}{*}}
			%%updated section
			{\item[\color{white}\textbullet]\color{white}}
			%%not yet included						
			{\ifthenelse{\equal{#1}{?}}
				%%major update section
				{\item[\color{orange}{\footnotesize update}]\color{white}}
				%%not yet included						
				{\item[\color{\ordColour}\textbullet]\color{\ordColour}}
			}
		}
	#2}

\newcommand{\titem}[2]{%
	\ifthenelse{\equal{#1}{*}}%
		{\color{white}}%
		{\color{\ordColour}}%
	#2}

\newcommand\ReportTitle[1]{\ReportLineHeader\titem{#1}{Title}}

\newcommand\ReportAbstract[5]
	{\ReportLineHeader\titem{#1}{Abstract}
	\begin{reportenum}
		\ritem{#2} {Research problem, its context and significance}
		\ritem{#3} {Research aim}
		\ritem{#4} {Research methodology}
		\ritem{#5} {Knowledge contribution and its implications}
	\end{reportenum}
}
	
\newcommand\ReportIntroduction[4]%
	{\ReportLineHeader\titem{#1}{Chapter 1: Introduction}
	\begin{reportenum}
		\ritem {#2} {Background to the research}
		\ritem {#3} {Justification for the research}
		\ritem {#4} {Definitions}
	\end{reportenum}
}

\newcommand\ReportLitRev[3]%
	{\ReportLineHeader\titem{#1}{Chapter 2: Literature review}
	 \begin{reportenum}
		\ritem {#2}{Review of existing relevant knowledge}
		\ritem {#3}{Critical summary, including knowledge gap to be addressed by the research}
	\end{reportenum}
}

\newcommand\ReportResearchDef[4]%
	{\ReportLineHeader\titem{#1}{Chapter 3: Research Definition}
		 \begin{reportenum}
			\ritem{#2}  {Problem statement}
			\ritem{#3}  {Aim and objectives} 
			\ritem{#4}  {Knowledge contribution}
		\end{reportenum}
	}

\newcommand\ReportResearchDes[5]%
	{\ReportLineHeader  \titem{#1}{Chapter 4: Research design}
		 \begin{reportenum}
			\ritem{#2}  {Data and evidence} 
			\ritem{#3}  {Research strategy and methods} 
			\ritem{#4}  {Research procedures} 
			\ritem{#5}  {Ethics and regulations} 
		\end{reportenum}
	}

\newcommand\ReportAnalysisInterp[4]%
	{\ReportLineHeader \titem{#1}{Chapter 5: Analysis and interpretation}
		 \begin{reportenum}
			\ritem{#2}  {Summary and analysis of data} 
			\ritem{#3}  {Summary of key findings} 
			\ritem{#4} {Interpretation in relation to aim and objectives} 
		\end{reportenum}
	}

\newcommand\ReportEvalConc[7]%
	{\ReportLineHeader  \titem{#1}{Chapter 6: Evaluation and conclusion}
	 \begin{reportenum}
		\ritem{#2}  {Evaluation against aim and objectives} 
		\ritem{#3}  {Evaluation against related work in the literature} 
		\ritem{#4}  {Validity of the research} 
		\ritem{#5}  {Future work} 
		\ritem{#6}  {Implications for practice} 
		\ritem{#7}  {Reflexive account} 
	\end{reportenum}
}

\newcommand\ReportRefs[1]{\ReportLineHeader\titem{#1}{References}}


\newcommand\ReportProgressTracking[6]%
	{\ReportLineHeader\titem{#1}{Appendix - Progress tracking}
	\begin{reportenum}
		\ritem{#2}{Fit}
		\ritem{#3}{Feasibility}
		\ritem{#4}{Risk assessment}
		\ritem{#5}{Work schedule}
		\ritem{#6}{Further reading to be completed}
	\end{reportenum}
}

\newcommand\ReportReflection[2]%
	{\ReportLineHeader\titem{#1}{Appendix - Reflection and reflexivity}
	\begin{reportenum}
		\ritem{#2}{Personal statement}
	\end{reportenum}
}

\newcommand\ReportDissertationAppendices[2]%
	{\ReportLineHeader\titem{#1}{Dissertation appendices}
	\begin{reportenum}
		\ritem{#2}{Raw data, questionnaires, code, etc.}
	\end{reportenum}
}

\newcommand\ReportAppendices[1]{\ReportLineHeader\titem{#1}{Appendices}}



\newcommand{\WOCaption}[2]{Stage #1{} Writing Outcomes (#2\% of stage effort)}
\newcommand{\RActivitiesTableCaption}[1]{Stage #1{} Research Activities}

\endinput